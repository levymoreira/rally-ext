<link rel="import" href="setting-section.html">
<link rel="import" href="setting-one.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<dom-module id="radio-links">
  <style>
    :host {
      --paper-input-container-focus-color: var(--hp-blue);
      --default-primary-color: var(--hp-blue);
      display: block;
    }
    .hp-blue {
      color: var(--hp-blue);
    }
    .marginBottomZero {margin-bottom: 0}
    .radio-option {
      font-size: 16px;
      margin-right: 15px;
      color: #444;
    }
    paper-radio-button {
      display: block;
      padding-top: 8px;
      padding-bottom: 8px;
    }
    code {
      font-size: 12px
    }
  </style>
  <template>
    <paper-radio-group selected="{{valueSel}}">
      <paper-radio-button id="url" name="url" label="Small">
        <span class="radio-option">Url</span>
        <code>https://xxx.rallydev.com/path/to/task</code>
      </paper-radio-button>
      <paper-radio-button id="key" name="key" label="Medium">
        <span class="radio-option">Key</span>
        <code>US12345</code> or <code>FE123</code> or <code>TA1234</code> or <code>DE1234</code>
      </paper-radio-button>
      <paper-radio-button id="markdown" name="markdown" label="Large">
        <span class="radio-option">Markdown</span>
        <code>[FE123: something good somewhere](https://xxx.rallydev.com/path/to/task)</code>
      </paper-radio-button>
      <paper-radio-button id="confluence" name="confluence" label="Large">
        <span class="radio-option">Confluence</span>
        <code>[FE123: something good somewhere | https://xxx.rallydev.com/path/to/task]</code>
      </paper-radio-button>
      <paper-radio-button class="layout horizontal"id="simpleHtml" name="simpleHtml" label="Large">
        <span class="radio-option">Simple HTML</span>
        <code>&lt;a href="https://xxx.rallydev.com/path/to/task"&gt;FE123: something good somewhere&lt;/a&gt;</code>
      </paper-radio-button>
    </paper-radio-group>
  </template>
</dom-module>
<script>Polymer({
  is: "radio-links",
  properties : {
    valueSel: {
      type:String,
      notify: true,
      reflectToAttribute:true,
      value:''
    }
  }
  })</script>
<dom-module id="copy-to-clipboard">
  <style>
    :host {
      --paper-input-container-focus-color: var(--hp-blue);
      --default-primary-color: var(--hp-blue);
    }
    .hp-blue {
      color: var(--hp-blue);
    }
    setting-one > paper-input {
      padding-top: 0;
      max-width: 200px
    }
    .marginBottomZero {margin-bottom: 0}
    .radio-option {
      font-size: 16px;
      margin-right: 15px;
      color: #444;
    }
    paper-radio-button {
      display: block;
      padding-top: 8px;
      padding-bottom: 8px;
    }
    code {
      font-size: 12px
    }
  </style>
  <template>
    <setting-section id="section" sectionname="Copy To Clipboard"
      on-save="save" on-restore="restore">
      <setting-one>
        <h2 class="marginBottomZero">Icons refresh frenquency</h2>
        <paper-input id="refresh"
          label=""
          type="number"
          value=""></paper-input>
        <div class="description">
          The frequency the extension will look for links
           and add the copy-to-clipboard icon ( <span class="octicon-clippy octicon"></span> ) ext to it.<br/>
          With a smaller value, the icons will appear quicker but it can affect performance (not measured)
        </div>
      </setting-one>
      <setting-one>
        <h2 class="marginBottomZero">Check mark fadeout delay</h2>
        <paper-input id="fadeaway"
          label=""
          type="number"
          value=""></paper-input>
        <div class="description">
          The time needed for the check mark ( <span style="color:rgb(58, 135, 79);" class='octicon octicon-check'></span> ) to dissapear after the icon has been clicked.
        </div>
      </setting-one>
      <setting-one>
        <h2>Simple click handler</h2>
        <radio-links></radio-links>
        <div class="description">
          The type of link copied in the clipboard when performing a <span class="hp-blue"><b>simple</b></span> click.
        </div>
      </setting-one>
      <setting-one>
        <h2>Double click handler</h2>
        <radio-links></radio-links>
        <div class="description">
          The type of link copied in the clipboard when performing a <span class="hp-blue"><b>double</b></span> click.
        </div>
      </setting-one>
    </setting-section>
</template>
</dom-module>
<script>
  Polymer({
    is: 'copy-to-clipboard',
    properties: {
      conf: {
        type: Object,
        observer: "doLabels",
        notify:true
      },
      optionNames: {
        type: Array,
        value : [ 'injectionInterval', 'checkMarkFadeAwayDelay']
      }
    },
    formatToSeconds: function(val) {
      return Math.round(val/100)/10;
    },
    restore: function(e) {
      e.detail.optionNames = this.optionNames;
    },
    save: function(e) {
      e.detail.section='copyToClipboard';
      var isSuccess = true
        , options = {}
        ;

      try {
        this.addNumValue(this.$.refresh.value,'injectionInterval', options);
        this.addNumValue(this.$.fadeaway.value,'checkMarkFadeAwayDelay', options);
      } catch (saveNumE) {
        e.detail.error = saveNumE;
        isSuccess = false;
      } finally {
        e.detail.options = options;
      }
    },
    addNumValue: function(val,name,bag) {
      if(val==='') return;
      var numVal = Number.parseInt(val,10);
      if(isNaN(numVal)) {
        throw "Invalid input. Couldn't be parsed as a number"
        return;
      }
      bag[name] = Math.round(numVal*10)*100;
    },
    doLabels: function(newVal) {
      this.$.refresh.label= "Previous value: "+this.formatToSeconds(newVal.injectionInterval) + " sec";
      this.$.fadeaway.label= "Previous value: "+this.formatToSeconds(newVal.checkMarkFadeAwayDelay) + " sec";
    },
    // Element Lifecycle
    ready: function() {
      this.$.refresh.inputElement.setAttribute('min',"0")
      this.$.fadeaway.inputElement.setAttribute('min',"0")
    },
    highlightSection: function(toggle) {
      return function() {
        this.$.section.highlighted = toggle;
      }
    },
    attached: function() {
      this.$.refresh.inputElement.addEventListener('focus',this.highlightSection(true).bind(this));
      this.$.refresh.inputElement.addEventListener('blur',this.highlightSection(false).bind(this));
      this.$.fadeaway.inputElement.addEventListener('focus',this.highlightSection(true).bind(this));
      this.$.fadeaway.inputElement.addEventListener('blur',this.highlightSection(false).bind(this));
    },
    detached: function() {
    },
  });
</script>
